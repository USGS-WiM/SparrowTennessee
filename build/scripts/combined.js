function addCommas(e){e+="";for(var t=e.split("."),a=t[0],i=t.length>1?"."+t[1]:"",s=/(\d+)(\d{3})/;s.test(a);)a=a.replace(s,"$1,$2");return a+i}function camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}function getChartOutfields(e){var t=[];switch(e){case 0:return $.each(Group3,function(e,a){$("#displayedMetricSelect").val()==a.field&&(t=Group3[e].chartOutfields)}),t;case 1:return $.each(Group2,function(e,a){$("#displayedMetricSelect").val()==a.field&&(t=Group2[e].chartOutfields)}),t;case 2:return $.each(Group1,function(e,a){$("#displayedMetricSelect").val()==a.field&&(t=Group1[e].chartOutfields)}),t;case 3:return $.each(ST,function(e,a){$("#displayedMetricSelect").val()==a.field&&(t=ST[e].chartOutfields)}),t}}function addMetricOptions(e){var t;switch(e){case 0:t=Group3;break;case 1:t=Group2;break;case 2:t=Group1;break;case 3:t=ST}$("#displayedMetricSelect").find("option").remove(),$.each(t,function(e,t){$("#displayedMetricSelect").append(new Option(t.name,t.field)),$("#displayedMetricSelect").selectpicker("refresh")})}function checkSelectedAggregateGroup(e,t){if("radio1"==t){var a;switch(e){case 0:a=0;break;case 1:a=1;break;case 2:a=2;break;case 3:a=3}}else if("radio2"==t){var a;switch(e){case 0:a=4;break;case 1:a=5;break;case 2:a=6;break;case 3:a=6}}var i=[a],s=map.getLayer("SparrowRanking");s.setVisibleLayers(i)}function showChart(e){function t(){var e=$("#groupResultsSelect")[0].selectedIndex;switch(e){case 0:return"Ranked By HUC10";case 1:return"Ranked By HUC8";case 2:return"Ranked By Independent Watershed";case 3:return"Ranked By State"}}var a,i,s=[],o=[],l=[],r=[];$.each(e.features[0].attributes,function(e,t){console.log(e,t),o.push(e)}),$.each(o,function(t,a){var i=[];$.each(e.features,function(e,t){console.log(a,t.attributes),i.push(t.attributes[a])}),l.push(i)}),s=l.shift(),o.shift(),console.log("chartArr",l),console.log("categories",o),console.log("columnLabels",s),$.each(o,function(e,t){r.push({name:t})}),$.each(l,function(e,t){r[e].data=l[e]}),a="Delivered Aggregated Load(kg)",i="option1"==$("#modelResultsRadio input:radio:checked").val()?"Phosphorus":"Nitrogen",$("#chartModal").modal("show");$("#chartContainer").highcharts();$(function(){$("#chartContainer").highcharts({chart:{type:"column",width:770},title:{text:i},xAxis:{categories:s,title:{text:t()}},yAxis:{min:0,title:{text:a},stackLabels:{enabled:!1,style:{fontWeight:"bold",color:Highcharts.theme&&Highcharts.theme.textColor||"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:-15,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white"}}},credits:{enabled:!1},series:r})})}var allLayers;require(["esri/geometry/Extent","esri/layers/WMSLayerInfo","esri/layers/FeatureLayer","dojo/domReady!"],function(e,t,a){1==$("#radio1")[0].checked?sparrowOverlay=0:sparrowOverlay=1,allLayers=[{groupHeading:"Nutrient Model",showGroupHeading:!0,includeInLayerList:!0,layers:{"Nutrient Model Results Overlay":{url:serviceBaseURL,visibleLayers:[sparrowOverlay],options:{id:"SparrowRanking",opacity:.75,visible:!0},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,hasOpacitySlider:!0,hasZoomto:!0,includeLegend:!1}}}},{groupHeading:"Auxilliary Layers",showGroupHeading:!0,includeInLayerList:!0,layers:{"Tennessee Mainstems":{url:serviceBaseURL,visibleLayers:[4],options:{id:"mainstems",opacity:.75,visible:!1},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,zoomScale:144448,hasOpacitySlider:!0,hasZoomto:!0,includeLegend:!0}},"Tennessee Streams":{url:serviceBaseURL,visibleLayers:[5],options:{id:"streams",visible:!1,opacity:.6},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,hasOpacitySlider:!0,hasZoomto:!0,includeLegend:!1}}}}]});var serviceBaseURL="http://gis.wim.usgs.gov/arcgis/rest/services/SparrowTennessee/SparrowTennesseeDev/MapServer/",Group3=[{field:"dl1_g3_tot",name:"Group Aggregate Load delivered to donwstream boundary",chartOutfields:["GRP_3_NAM","dl1_g3_sc1","dl1_g3_sc2","dl1_g3_sc3","dl1_g3_sc4","dl1_g3_sc5","dl1_g3_sc6"]},{field:"dy1_g3_tot",name:"Group Aggregate Yield delivered to donwstream boundary",chartOutfields:["GRP_3_NAM","dy1_g3_sc1","dy1_g3_sc2","dy1_g3_sc3","dy1_g3_sc4","dy1_g3_sc5","dy1_g3_sc6"]},{field:"dl3_g3_tot",name:"Group Aggregate Load delivered to Group’s outlet",chartOutfields:["GRP_3_NAM","dl3_g3_sc1","dl3_g3_sc2","dl3_g3_sc3","dl3_g3_sc4","dl3_g3_sc5","dl3_g3_sc6"]},{field:"dy3_g3_tot",name:"Group Aggregate Yield delivered to Group’s outlet",chartOutfields:["GRP_3_NAM","dy3_g3_sc1","dy3_g3_sc2","dy3_g3_sc3","dy3_g3_sc4","dy3_g3_sc5","dy3_g3_sc6"]},{field:"al_g3_tot",name:"Accumulated Load at Group’s outlet",chartOutfields:["GRP_3_NAM","al_g3_sc1","al_g3__sc2","al_g3_sc3","al_g3_sc4","al_g3_sc5","al_g3_sc6"]},{field:"ay_g3_tot",name:"Accumulated Yield at Group’s outlet",chartOutfields:["GRP_3_NAM","ay_g3_sc1","ay_g3__sc2","ay_g3_sc3","ay_g3_sc4","ay_g3_sc5","ay_g3_sc6"]}],Group2=[{field:"dl1_g2_tot",name:"Group Aggregate Load delivered to donwstream boundary",chartOutfields:["GRP_2_NAM","dl1_g2_sc2","dl1_g2_sc3","dl1_g2_sc3","dl1_g2_sc4","dl1_g2_sc5","dl1_g2_sc6"]},{field:"dy1_g2_tot",name:"Group Aggregate Yield delivered to donwstream boundary",chartOutfields:["GRP_2_NAM","dy1_g2_sc1","dy1_g2_sc2","dy1_g2_sc3","dy1_g2_sc3","dy1_g2_sc4","dy1_g2_sc5","dy1_g2_sc6"]},{field:"dl2_g2_tot",name:"Group Aggregate Load delivered to Group’s outlet",chartOutfields:["GRP_2_NAM","dl2_g2_sc2","dl2_g2_sc3","dl2_g2_sc3","dl2_g2_sc4","dl2_g2_sc5","dl2_g2_sc6"]},{field:"dy2_g2_tot",name:"Group Aggregate Yield delivered to Group’s outlet",chartOutfields:["GRP_2_NAM","dy2_g2_sc1","dy2_g2_sc2","dy2_g2_sc3","dy2_g2_sc3","dy2_g2_sc4","dy2_g2_sc5","dy2_g2_sc6"]}],Group1=[{field:"dl1_g1_tot",name:"Group Aggregate Load delivered to donwstream boundary",chartOutfields:["GRP_1_NAM","dl1_g1_sc1","dl1_g1_sc2","dl1_g1_sc3","dl1_g1_sc4","dl1_g1_sc5","dl1_g1_sc6"]},{field:"dy1_g1_tot",name:"Group Aggregate Yield delivered to donwstream boundary",chartOutfields:["GRP_1_NAM","dy1_g1_sc1","dy1_g1_sc2","dy1_g1_sc3","dy1_g1_sc4","dy1_g1_sc5","dy1_g1_sc6"]}],ST=[{field:"dl1_ST_tot",name:"State Aggregate Load delivered to downstream boundary",chartOutfields:["ST","dl1_ST_sc1","dl1_ST_sc2","dl1_ST_sc3","dl1_ST_sc4","dl1_ST_sc5","dl1_ST_sc6"]},{field:"dy1_ST_tot",name:"State Aggregate Yield delivered to downstream boundary",chartOutfields:["ST","dy1_ST_sc1","dy1_ST_sc2","dy1_ST_sc3","dy1_ST_sc4","dy1_ST_sc5","dy1_ST_sc6"]},{field:"I_ST_tot",name:"State Aggregate Load",chartOutfields:["ST","I_ST_sc1","I_ST_sc2","I_ST_sc3","I_ST_sc4","I_ST_sc5","I_ST_sc6"]},{field:"y_ST_tot",name:"State Aggregate Yield",chartOutfields:["ST","y_ST_sc1","y_ST_sc2","y_ST_sc3","y_ST_sc4","y_ST_sc5","y_ST_sc6"]}],queryParameters={grp3:{idField:"GRP_3_NUM",nameField:"GRP_3_NAM",alias:"HUC10",serviceId:0,AOISelect:!1},grp2:{idField:"GRP_2_NUM",nameField:"GRP_2_NAM",alias:"HUC8",serviceId:1,AOISelect:!0},grp1:{idField:"GRP_1_NUM",nameField:"GRP_1_NAM",alias:"Independent Watershed",serviceId:2,AOISelect:!0},st:{idField:"ST",nameField:"ST",alias:"State",serviceId:3,AOISelect:!0}};$(".selectpicker").selectpicker();var map,allLayers,maxLegendHeight,maxLegendDivHeight,dragInfoWindows=!0,defaultMapCenter=[-86,36],queryParametersLength=Object.getOwnPropertyNames(queryParameters).length;require(["esri/arcgis/utils","esri/map","esri/tasks/QueryTask","esri/tasks/query","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/Geocoder","esri/dijit/PopupTemplate","esri/graphic","esri/geometry/Multipoint","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/geometry/webMercatorUtils","dojo/dnd/Moveable","dojo/query","dojo/dom","dojo/dom-class","dojo/on","dojo/domReady!"],function(e,t,a,i,s,o,l,r,n,c,d,p,g,u,y,m,h,f,_){function v(e,t,a){var i;i=new esri.tasks.QueryTask(e);var s=new esri.tasks.Query;s.returnGeometry=!1,s.outFields=t,s.where=a,i.execute(s,b)}function b(e){switch(e.displayFieldName){case queryParameters.grp3.nameField:console.log("Currently no AOI for Group 3");break;case queryParameters.grp2.nameField:$.each(e.features,function(e,t){$("#grp2-select").append(new Option(t.attributes.GRP_2_NAM,t.attributes.GRP_2_NUM)),$("#grp2-select").selectpicker("refresh")});break;case queryParameters.grp1.nameField:$.each(e.features,function(e,t){$("#grp1-select").append(new Option(t.attributes.GRP_1_NAM,t.attributes.GRP_1_NUM)),$("#grp1-select").selectpicker("refresh")});break;case queryParameters.st.nameField:$.each(e.features,function(e,t){$("#st-select").append(new Option(t.attributes.ST,t.attributes.ST)),$("#st-select").selectpicker("refresh")})}}function S(){1===h.byId("chkExtent").checked?A.activeGeocoder.searchExtent=map.extent:A.activeGeocoder.searchExtent=null}function w(){S();var e=A.find();e.then(function(e){k(e)}),$("#geosearchModal").modal("hide")}function L(e){T();var t=e.graphic?e.graphic:e.result.feature;t.setSymbol(z)}function k(e){if(e=e.results,e.length>0){T();for(var t=0;t<e.length;t++);var a=new p(e[0].feature.geometry);map.centerAndZoom(a,17)}}function T(){map.infoWindow.hide(),map.graphics.clear()}function x(e,t,a,i,s){return new g({angle:0,xoffset:t,yoffset:a,type:"esriPMS",url:e,contentType:"image/png",width:i,height:s})}function O(){$("#chartContainer").empty(),console.log("creating chart query");var e,t=map.getLayer("SparrowRanking").visibleLayers[0],a=serviceBaseURL+t;e=new esri.tasks.QueryTask(a);var i=new esri.tasks.Query;i.returnGeometry=!1,i.outFields=getChartOutfields(t),i.where="1=1",e.execute(i,showChart)}$("#groupResultsSelect").on("loaded.bs.select",function(){addMetricOptions($("#groupResultsSelect")[0].selectedIndex)}),$("#groupResultsSelect").on("changed.bs.select",function(e){addMetricOptions(e.currentTarget.selectedIndex),console.log($("#radio")),checkSelectedAggregateGroup(e.currentTarget.selectedIndex,$(".radio input[type='radio']:checked")[0].id)}),$(".clearAOI").on("click",function(){var e="#"+this.classList[1];$(e).selectpicker("deselectAll")}),map=t("mapDiv",{basemap:"gray",center:defaultMapCenter,zoom:7});for(var G in queryParameters)v(serviceBaseURL+queryParameters[G].serviceId,[queryParameters[G].namefield],"1=1");var M=new s({map:map},"homeButton");M.startup();var I=new o({map:map},"locateButton");I.startup(),$(window).resize(function(){$("#legendCollapse").hasClass("in")?(maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("height",maxLegendHeight),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)):$("#legendElement").css("height","initial")}),_(map,"load",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e);var t=u.webMercatorToGeographic(map.extent.getCenter());if($("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3)),1==dragInfoWindows){var a=m(".title",map.infoWindow.domNode)[0],i=new y(map.infoWindow.domNode,{handle:a});_(i,"FirstMove",function(){var e=m(".outerPointer",map.infoWindow.domNode)[0];f.add(e,"hidden");var e=m(".pointer",map.infoWindow.domNode)[0];f.add(e,"hidden")}.bind(this))}}),_(map,"zoom-end",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e)}),_(map,"mouse-move",function(e){if($("#mapCenterLabel").css("display","none"),null!=e.mapPoint){var t=u.webMercatorToGeographic(e.mapPoint);$("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3))}}),_(map,"pan-end",function(){$("#mapCenterLabel").css("display","inline");var e=u.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(e.y.toFixed(3)),$("#longitude").html(e.x.toFixed(3))});var C=new l("http://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer");_(h.byId("btnStreets"),"click",function(){map.setBasemap("streets"),map.removeLayer(C)}),_(h.byId("btnSatellite"),"click",function(){map.setBasemap("satellite"),map.removeLayer(C)}),_(h.byId("btnHybrid"),"click",function(){map.setBasemap("hybrid"),map.removeLayer(C)}),_(h.byId("btnTerrain"),"click",function(){map.setBasemap("terrain"),map.removeLayer(C)}),_(h.byId("btnGray"),"click",function(){map.setBasemap("gray"),map.removeLayer(C)}),_(h.byId("btnNatGeo"),"click",function(){map.setBasemap("national-geographic"),map.removeLayer(C)}),_(h.byId("btnOSM"),"click",function(){map.setBasemap("osm"),map.removeLayer(C)}),_(h.byId("btnTopo"),"click",function(){map.setBasemap("topo"),map.removeLayer(C)}),_(h.byId("btnNatlMap"),"click",function(){map.addLayer(C)}),_(map,"click",function(e){var t=new c,a=t,i=new esri.InfoTemplate("test popup","attributes and stuff go here");a.setInfoTemplate(i),map.infoWindow.setFeatures([a]),map.infoWindow.show(e.mapPoint),map.infoWindow.show()});var A=new r({value:"",maxLocations:25,autoComplete:!0,arcgisGeocoder:!0,autoNavigate:!1,map:map},"geosearch");A.startup(),A.on("select",L),A.on("findResults",k),A.on("clear",T),_(A.inputNode,"keydown",function(e){13==e.keyCode&&S()});var z=x("../images/purple-pin.png",0,12,13,24);map.on("load",function(){map.infoWindow.set("highlight",!1),map.infoWindow.set("titleInBody",!1)}),_(h.byId("btnGeosearch"),"click",w),$(document).ready(function(){function e(){$("#geosearchModal").modal("show")}function t(){$("#aboutModal").modal("show")}$("#geosearchNav").click(function(){e()}),$("#aboutNav").click(function(){t()}),$("#html").niceScroll(),$("#sidebar").niceScroll(),$("#sidebar").scroll(function(){$("#sidebar").getNiceScroll().resize()}),$("#legendDiv").niceScroll(),maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),$("#legendCollapse").on("shown.bs.collapse",function(){maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)}),$("#legendCollapse").on("hide.bs.collapse",function(){$("#legendElement").css("height","initial")}),$(".radio").on("change",function(e){var t=$("#groupResultsSelect")[0].selectedIndex,a=this.firstElementChild.id;checkSelectedAggregateGroup(t,a)}),$(".nonAOISelect").on("change",function(){0==$("#groupResultsSelect")[0].selectedIndex&&(4==$("#displayedMetricSelect")[0].selectedIndex||5==$("#displayedMetricSelect")[0].selectedIndex)?$("#chartButton").addClass("disabled"):$("#chartButton").removeClass("disabled")}),$("#chartButton").on("click",O)}),require(["esri/dijit/Legend","esri/tasks/locator","esri/tasks/query","esri/tasks/QueryTask","esri/graphicsUtils","esri/geometry/Point","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/SpatialReference","esri/layers/WMSLayer","esri/layers/WMSLayerInfo","dijit/form/CheckBox","dijit/form/RadioButton","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/on"],function(e,t,a,i,s,o,l,r,n,c,d,p,g,u,y,m,h,f,_,v){function b(e,t,a,i,s,l,r){if(map.addLayer(a),w.push([s,camelize(i),a]),s){if(!$("#"+camelize(s)).length){var n=$('<div id="'+camelize(s+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+s+"</button> </div>");n.click(function(e){n.find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$.each(w,function(e,t){var a=map.getLayer(t[2].id);if(t[0]==s)if($("#"+t[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&n.find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",t[1]),map.addLayer(t[2]);var a=map.getLayer(t[2].id);a.setVisibility(!0)}else n.find("i.glyphspan").hasClass("fa-square-o")&&(console.log("removing layer: ",t[1]),map.removeLayer(t[2]))})});var d=$('<div id="'+camelize(s)+'" class="btn-group-vertical" data-toggle="buttons"></div');$("#toggle").append(d)}if(a.visible)var p=$('<div id="'+camelize(i)+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(s)+'" autocomplete="off"><i class="glyphspan fa fa-dot-circle-o '+camelize(s)+'"></i>&nbsp;&nbsp;'+i+"</label> </div>");else var p=$('<div id="'+camelize(i)+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(s)+'" autocomplete="off"><i class="glyphspan fa fa-circle-o '+camelize(s)+'"></i>&nbsp;&nbsp;'+i+"</label> </div>");$("#"+camelize(s)).append(p),p.click(function(e){if($(this).find("i.glyphspan").hasClass("fa-circle-o")){$(this).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o");var t=$(this)[0].id;$.each(w,function(e,a){if(a[0]==s)if(a[1]==t&&$("#"+camelize(s+" Root")).find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",a[1]),map.addLayer(a[2]);var i=map.getLayer(a[2].id);i.setVisibility(!0)}else a[1]==t&&$("#"+camelize(s+" Root")).find("i.glyphspan").hasClass("fa-square-o")?console.log("groud heading not checked"):(console.log("removing layer: ",a[1]),map.removeLayer(a[2]),$("#"+a[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&$("#"+a[1]).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o"),$("#"+camelize(this[1])).toggle())})}})}else{if(a.visible&&void 0!==r.hasOpacitySlider&&1==r.hasOpacitySlider&&void 0!==r.hasZoomto&&1==r.hasZoomto)var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right opacity"></span><span class="glyphicon glyphicon-search pull-right zoomto"></span></button></div>');else if(a.visible||void 0===r.hasOpacitySlider||1!=r.hasOpacitySlider||void 0===r.hasZoomto||1!=r.hasZoomto)if(a.visible&&void 0!==r.hasOpacitySlider&&1==r.hasOpacitySlider)var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></div>');else if(a.visible||void 0===r.hasOpacitySlider||1!=r.hasOpacitySlider)if(a.visible&&0==r.hasOpacitySlider&&void 0!==r.hasZoomto&&1==r.hasZoomto)var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span class="glyphicon glyphicon-search pull-right zoomto"></span></button></span></div>');else if(a.visible||0!=r.hasOpacitySlider||void 0===r.hasZoomto||1!=r.hasZoomto)if(a.visible)var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+"</button></span></div>");else var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+"</button> </div>");else var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span class="glyphicon glyphicon-search pull-right zoomto"></span></button></span></div>');else var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></div>');else var p=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right opacity"></span><span class="glyphicon glyphicon-search pull-right zoomto"></span></button></div>');p.click(function(e){$(this).find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$(this).find("button").button("toggle"),e.preventDefault(),e.stopPropagation(),$("#"+camelize(i)).toggle(),a.visible?a.setVisibility(!1):a.setVisibility(!0)})}if(t){var g=camelize(e);if(!$("#"+g).length){var u=$('<div id="'+g+'"><div class="alert alert-info" role="alert"><strong>'+e+"</strong></div></div>");$("#toggle").append(u)}s?($("#"+g).append(n),$("#"+g).append(d)):($("#"+g).append(p),$("#opacity"+camelize(i)).length>0&&$("#opacity"+camelize(i)).hover(function(){$(".opacitySlider").remove();var e=map.getLayer(l.id).opacity,t=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+e+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(t),$("#slider")[0].value=100*e,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var t=$("#slider")[0].value/100;console.log("o: "+t),$("#opacityValue").html("Opacity: "+t),map.getLayer(l.id).setOpacity(t)})}),$(".zoomto").hover(function(e){$(".zoomDialog").remove();var t=this.parentNode.id,a=$('<div class="zoomDialog"><label class="zoomClose pull-right">X</label><br><div class="list-group"><a href="#" id="zoomscale" class="list-group-item lgi-zoom zoomscale">Zoom to scale</a> <a id="zoomcenter" href="#" class="list-group-item lgi-zoom zoomcenter">Zoom to center</a><a id="zoomextent" href="#" class="list-group-item lgi-zoom zoomextent">Zoom to extent</a></div></div>');$("body").append(a),$(".zoomDialog").css("left",event.clientX-80),$(".zoomDialog").css("top",event.clientY-5),$(".zoomDialog").mouseleave(function(){$(".zoomDialog").remove()}),$(".zoomClose").click(function(){$(".zoomDialog").remove()}),$("#zoomscale").click(function(e){var a=map.getLayer(t).minScale;map.setScale(a)}),$("#zoomcenter").click(function(e){var t=new o(defaultMapCenter,new c({wkid:4326}));map.centerAt(t)}),$("#zoomextent").click(function(e){var a=map.getLayer(t).fullExtent;map.setExtent(a)})}))}else $("#toggle").append(p)}var S=[],w=[];$.each(allLayers,function(e,t){console.log("processing: ",t.groupHeading),$.each(t.layers,function(e,a){var i="";if(a.wimOptions.exclusiveGroupName&&(i=a.wimOptions.exclusiveGroupName),"agisFeature"===a.wimOptions.layerType){var s=new n(a.url,a.options);a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:s,title:e}),b(t.groupHeading,t.showGroupHeading,s,e,i,a.options,a.wimOptions)}else if("agisWMS"===a.wimOptions.layerType){var s=new d(a.url,{resourceInfo:a.options.resourceInfo,visibleLayers:a.options.visibleLayers},a.options);a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:s,title:e}),b(t.groupHeading,t.showGroupHeading,s,e,i,a.options,a.wimOptions)}else if("agisDynamic"===a.wimOptions.layerType){var s=new r(a.url,a.options);a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:s,title:e}),a.visibleLayers&&s.setVisibleLayers(a.visibleLayers),b(t.groupHeading,t.showGroupHeading,s,e,i,a.options,a.wimOptions)}})});var L=new e({map:map,layerInfos:S},"legendDiv");L.startup()})}),$(document).ready(function(){});